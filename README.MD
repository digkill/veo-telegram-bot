# ğŸ¥ Veo Telegram Bot

A powerful Telegram bot written in Go, using **Google Veo 2.0 API** to generate AI-powered videos from text prompts and optional images.  
Supports payment systems (Telegram Payments and YooKassa), credit tracking, logging, and runs as a Linux daemon via **Supervisor**.

---

## ğŸ“¦ Features

- âœ… Generate videos from text prompts (with optional image)
- ğŸ§  Google Veo 2.0 API integration
- ğŸ’³ Buy credits using Telegram Payments and YooKassa
- ğŸ“Š Track logs of all actions and errors
- ğŸ” Secure credit accounting & transactions
- ğŸ§¾ Logging to file in JSON format
- ğŸ›  Daemon management with Supervisor
- ğŸ˜ MySQL storage with Goose migrations

---

## âš™ï¸ Installation

### 1. Clone the repository

```bash
git clone https://github.com/digkill/veo-telegram-bot.git
cd veo-telegram-bot
```

### 2. Install dependencies

```bash
make install-deps
```

Installs:
- `ffmpeg`
- `jq`
- `curl`
- `supervisor`
- `unzip`

### 3. Install Google Cloud CLI

```bash
make install-gcloud
make gcloud-auth
```

---

## ğŸ” .env Configuration

Create a `.env` file like this:

```env
TELEGRAM_BOT_TOKEN=123456:ABCDEF
PROVIDER_TOKEN=your_telegram_or_yookassa_token
PROJECT_ID=vigilant-augury-xxxxxx
LOCATION_ID=us-central1
API_ENDPOINT=us-central1-aiplatform.googleapis.com
MODEL_ID=veo-2.0-generate-001

DB_DSN=digkill:YOUR_PASSWORD@tcp(YOUR_DB_HOST:PORT)/veogenbot_db?parseTime=true
```

---

## ğŸ—ƒ Database Migrations

### Apply migrations:

```bash
make migrate-up
```

### Rollback:

```bash
make migrate-down
```

---

## ğŸ¤– Run the bot manually

```bash
go run cmd/main.go
```

Or compile:

```bash
go build -o bot
./bot
```

---

## ğŸ›¡ Run as a background service (Supervisor)

### Create config: `/etc/supervisor/conf.d/veo-bot.conf`

```ini
[program:veo-bot]
directory=/opt/veo-bot
command=/opt/veo-bot/bot
autostart=true
autorestart=true
stderr_logfile=/var/log/veo-bot.err.log
stdout_logfile=/var/log/veo-bot.out.log
user=www-data
environment=HOME="/home/www-data",USER="www-data"
```

### Control Supervisor:

```bash
sudo supervisorctl reread
sudo supervisorctl update
sudo supervisorctl start veo-bot
```

---

## ğŸ§ª Test generation (no Telegram)

```bash
go run cmd/generate_test.go
```

---

## ğŸ“ Project Structure

```
.
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ main.go             # Bot entry point
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ bot/                # Telegram update handlers
â”‚   â”œâ”€â”€ generator/          # Veo API curl generator
â”‚   â”œâ”€â”€ db/                 # Goose migrations
â”‚   â”œâ”€â”€ repository/         # User DB helpers
â”‚   â”œâ”€â”€ logger/             # JSON logger
â”‚   â””â”€â”€ utils/              # Env and misc
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ request.tpl.json    # Veo prompt templates
â”œâ”€â”€ storage/
â”‚   â””â”€â”€ logs/               # All logs in JSON
â””â”€â”€ Makefile
```

---

## ğŸ’¡ Optional extensions

- React-based admin panel
- View generation history by user
- Subscription plans (monthly limits)
- Prompt suggestion system
- Support for voice/image inputs

---

## ğŸ†˜ Troubleshooting

If something breaks:

1. Check `.env` for missing vars
2. Inspect `storage/logs/logs.txt`
3. Run `supervisorctl status`
4. Try `gcloud auth print-access-token`
5. Make sure your service account is allowlisted in GCP

---

## ğŸ“œ License

MIT Â© 2025 [Mediarise](https://mediarise.ru)